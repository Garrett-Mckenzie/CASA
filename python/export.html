<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html">
        <meta charset="UTF-8">
        <title>Import/Export | Rappahannock CASA</title>
        <link rel="stylesheet" href="styler.scss">
        <!-- Popup for download link -->
        <script>
            const urlParams = new URLSearchParams(window.location.search);
            const success = urlParams.get('success');
            const file = urlParams.get('file');
            const filename = file.substring(file.lastIndexOf('\\') + 1);
            if(file){
                window.onload = function() {
                    document.getElementById('popText').innerHTML = 'Download: ';
                    document.getElementById('popLink').setAttribute('href', file);
                    document.getElementById('popLink').innerHTML = filename;
                    document.getElementById('popup').style.visibility = 'visible';
                }
            }

            async function handleExport(event){
                const sass = await import("https://jspm.dev/sass");
                event.preventDefault();

                const form = event.target;
                const formData = new FormData(form);

                const response = await fetch(form.action, {
                    method: form.method,
                    body: formData,
                });

                const result = await response.text();

                const popup = document.createElement('div');
                popup.style.position = 'fixed';
                popup.innerHTML = `
                    <p>${result}</p>
                    <button onclick="this.parentElement.remove()">Close</button> `;
                document.body.appendChild(popup);
            }
        </script>
    </head>
    <body>
        <header>
            <nav>
                <table></table>
            </nav>
        </header>
        <main>
            <form class="exportForm" action="ExportHandler.php" method="post" enctype="multipart/form-data" accept-charset="UTF-8">
                <table class="options">
                    <tr class="Donor">
                        <td class="info"><h3>Export Donor Information</h3></td>
                        <td class="buttonCell"><button name="export" id="donor" value="donor" type="submit">Download</button></td>
                    </tr>
                    <tr class="Donation">
                        <td class="info">Export Donation Information</td>
                        <td class="startDate"><input type="date" name="startDate" id="startDate"></i><input class="endDate" type="date" name="endDate" id="endDate"></td>
                        <td class="buttonCell"><button name="export" id="donation" value="donation" type="submit">Download</button></td>
                    </tr>
                </table>
            </form>
            <div id="popup" style="visibility: hidden;">
                <p id="popText"></p>
                <a id="popLink" href="" rel="noreferer" target="_blank"></a>
            </div>
        </main>
    </body>
</html>